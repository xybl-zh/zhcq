<!DOCTYPE html>
<html lang="zh">
<head>
    <!-- ...existing code... -->
    <style>
    /* ...existing code... */

       
        label[for="excludeInput"],
        #excludeInput {
            display: none !important;
        }

        /* 强制浅色主题与白色背景（覆盖客户端/系统主题） */
        :root { color-scheme: light; }
        html, body { background-color: #ffffff !important; color: #222 !important; }
        .container { background: #fff !important; }

        /* 结果行显示：使最终名字尽量在同一行，超出时换行到下一行 */
        .selected-list {
            display: flex;
            flex-wrap: wrap;           /* 超出时换行到下一行 */
            justify-content: center;   /* 居中排列 */
            align-items: center;
            gap: 0;                    /* 使用 ::after 添加固定两个空格 */
            padding: 0;
            margin: 0;
        }

        .selected-list li {
            list-style: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 4px 0;
            font-size: 1.6em;          /* 可按需调整最终名字字号 */
            color: #007bff;
            font-weight: 700;
            white-space: nowrap;       /* 名字本身不换行 */
        }

        /* 在每个条目后添加两个不间断空格，最后一个不添加 */
        .selected-list li.slot::after {
            content: "\00a0\00a0\00a0\00a0";     /* 两个 NBSP，等同于“两个字符的空格” */
        }
        .selected-list li.slot:last-child::after {
            content: "";
        }

        /* 保持动画中滚轴文本样式（span.reel）与最终名字对齐 */
        .slot .reel {
            display: inline-block;
            font-size: 1.0em;          /* 滚动时的小字号（不影响 li 的显示） */
            line-height: 1.0em;
            padding: 0 8px;
            color: inherit;
            font-weight: 700;
        }

        /* 最终结果高亮（保持字号与父 li 一致） */
        .selected-final {
            color: #007bff;
            text-shadow: 0 2px 8px rgba(0,86,179,0.12);
            animation: pulse 0s infinite;
            font-size: inherit;
        }

        /* 其它原有样式保持 */
        /* ...existing code... */
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>邢影不离课题组会随机抽签</title>
    <style>
        /* 1. 基础样式和 1920x1080 居中容器 */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            background-color: #f4f4f9;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 1200px;
            max-width: 90vw;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #0056b3;
            text-align: center;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 10px;
            margin-bottom: 30px;
            width: 100%;
        }

        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: bold;
            align-self: flex-start; 
        }

        /* 修复输入框和文本域的对齐问题，并设置固定宽度 */
        textarea, input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            align-self: flex-start;
            overflow: hidden; /* 隐藏滚动条，改用自动撑高 */
            min-height: 10px; /* 作为降级方案，可调整 */
            resize: vertical;  /* 允许用户垂直调整高度 */
        }

        .input-group {
            width: 100%;
            max-width: 1000px; /* 限制输入区域最大宽度，使所有输入控件宽度一致 */
            /* 确保 input-group 本身在 .container 中是居中的，但内部元素是靠左对齐的 */
            align-self: center;
        }

        .button-group {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 20px;
        }

        button {
            background-color: #28a745;
            color: white;
            padding: 10px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            margin: 0 10px;
            transition: background-color 0.3s, transform 0.1s;
        }

        button:hover {
            background-color: #1e7e34;
        }
        
        button:active {
            transform: scale(0.98);
        }

        /* 2. 抽取结果界面 */
.result-box {
            margin-top: 5px;
            padding: 0px;
            width: 100%;
            /* ********** 保持和 .input-group 相同的最大宽度 ********** */
            max-width: 1000px; 
            min-height: 150px;
            /* 虚线边框和 2px 宽度 */
            border: 2px dashed #0056b3; 
            border-radius: 10px;
            background-color: #e9f5ff;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .result-box h2 {
            color: #0056b3;
            margin-top: 0;
            margin-bottom: 20px;  /* 减小标题底部间隙，避免 margin 变化影响布局 */
            font-size: 1.5em;
        }

        .selected-list {
            list-style: none;
            padding: 0;
            min-height: 2.2em;     /* 与单行 li 高度一致 */
        }

        .selected-list li {
            font-size: 2.5em; 
            /* 名字改为醒目的蓝色 */
            color: #007bff; 
            font-weight: bold;
            padding: 5px 0;
            animation: pulse 1.5s infinite;
            display: inline-flex;
            align-items: center;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .error {
            color: #dc3545;
            font-weight: bold;
            margin-top: 15px;
        }

        /* 保证占位滚轴和最终名字字号一致，避免首帧变大推移 */
.selected-list li,
.selected-list li .reel {
  font-size: 1.6em;      /* 与最终名字一致 */
  line-height: 1;        /* 控制行高 */
  height: 2.2em;         /* 固定高度，防止高度跳变 */
  display: inline-flex;
  align-items: center;
}

/* 如果你允许多名同时显示，按行留出空间（可选） */
.result-box { 
  min-height: 170px;     /* 保持整个结果区域高度稳定（你已有 150，可视需要微调） */
}
    </style>
</head>
<body>
    <div class="container">
        <h1>“邢影不离”课题组 组会随机抽签</h1>

        <div class="input-group">
            <label for="namesTable">输入所有组员姓名：</label>
            <div id="namesTableContainer" style="width:100%; max-width:1000px; margin-bottom:15px;">
                <div style="max-height:none; border:1px solid #ccc; border-radius:5px; background:#fff; overflow:visible; padding:6px;">
                    <table id="namesTable" style="width:100%; border-collapse:collapse; table-layout:fixed;">
                        <thead>
                            <tr>
                                <th style="text-align:left; border-bottom:1px solid #ddd; width:12.5%;"></th>
                                <th style="text-align:left; border-bottom:1px solid #ddd; width:12.5%;"></th>
                                <th style="text-align:left; border-bottom:1px solid #ddd; width:12.5%;"></th>
                                <th style="text-align:left; border-bottom:1px solid #ddd; width:12.5%;"></th>
                                <th style="text-align:left; border-bottom:1px solid #ddd; width:12.5%;"></th>
                                <th style="text-align:left; border-bottom:1px solid #ddd; width:12.5%;"></th>
                                <th style="text-align:left; border-bottom:1px solid #ddd; width:12.5%;"></th>
                                <th style="text-align:left; border-bottom:1px solid #ddd; width:12.5%;"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="杨舒涵" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="陈媛媛" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="吉菠" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="韩继成" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="高菲" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="高源汇" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="王新月" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="黄悦佳" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                            </tr>
                            <tr>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="黄琴" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="蔡其君" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="徐云龙" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="仲慧" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="万炎森" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="周一舟" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="江荣坤" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="王梦鸽" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                            </tr>
                            <tr>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="赵雨欣" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="李睿" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="郝庆翔" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="胡明律" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="汤瑞" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="赖丽婷" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="丁宇昊" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="丽丽" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                            </tr>
                            <tr>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="李维康" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="戴怡珑" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="孙冰洁" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="孙娇凡" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="倪诗莹" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="于士博" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="王文豪" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="宦东明" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                            </tr>
                            <tr>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="李蔷" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="陆从昊" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="李牧遥" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="何文太" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="李振良" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="刘佳琰" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="张颖" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="蔡方磊" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                            </tr>
                            <tr>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="韩笑铮" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="李明鸿" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="翟浩然" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="刘松语" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="沈哲彬" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="姚焕地" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="张炜业" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="周科" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                            </tr>
                            <tr>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="吴浩燃" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="李玉龙" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="张千禧" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="邓心悦" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="张文康" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="王筱琪" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="杨欣雨" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="陆雪崟" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                            </tr>
                            <tr>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="崔恒杰" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="李逸川" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="张颖" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="冯潇晴" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="宋晴晴" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="杨琦琦" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="段鹏俊" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="梁政" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                            </tr>
                            <tr>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="周方骐" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="温新" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="王童超" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="丛文杰" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="宋彧奇" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="徐祥森" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                                <td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="" style="width:100%; border:none; outline:none; background:transparent;" />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div style="margin-top:8px; display:none;">
                    <button type="button" onclick="addEmptyRow()">添加一行（8 列）</button>
                    <button type="button" onclick="removeEmptyRows()" style="margin-left:8px;">移除空行</button>
                </div>
            </div>

            <!-- 隐藏的 textarea 保留用于兼容原有解析逻辑 -->
            <textarea id="namesInput" style="display:none;">
            杨舒涵 陈媛媛 吉菠 韩继成 高菲 高源汇 王新月 黄悦佳 黄琴 蔡其君 徐云龙 仲慧 万炎森 周一舟 江荣坤 王梦鸽 赵雨欣 李睿 郝庆翔 胡明律 汤瑞 赖丽婷 丁宇昊 丽丽 李维康 戴怡珑 孙冰洁 孙娇凡 倪诗莹 于士博 王文豪 宦东明 李蔷 陆从昊 李牧遥 何文太 李振良 刘佳琰 张颖 蔡方磊 韩笑铮 李明鸿 翟浩然 刘松语 沈哲彬 姚焕地 张炜业 周科 吴浩燃 李玉龙 张千禧 邓心悦 张文康 王筱琪 杨欣雨 陆雪崟 崔恒杰 李逸川 张颖 冯潇晴 宋晴晴 杨琦琦 段鹏俊 梁政 周方骐 温新 王童超 丛文杰 宋彧奇 徐祥森	
            </textarea>

            <!-- 新增：排除名单输入 -->
            <label for="excludeInput">排除名单（可选，逗号/换行/空格分隔）：</label>
            <input type="text" id="excludeInput" value="李四" placeholder="输入要排除的姓名，如：张三," style="width:100%;padding:10px;margin-bottom:15px;box-sizing:border-box;"/>

            <label for="numToDraw">抽取人数（1-100）：</label>
            <input type="number" id="numToDraw" min="1" max="100" value="1">
        </div>
        
        <div class="button-group">
            <button onclick="drawNames()">随机抽取</button>
            <button style="background-color: #0056b3;" onclick="resetDrawing()">重置抽签</button>
        </div>

        <p class="error" id="errorMessage"></p>

        <div class="result-box">
            <h2>本轮抽取结果</h2>
            <ul id="currentDrawResult" class="selected-list">
                <li class="slot"><span class="reel">（点击抽取按钮开始）</span></li>
            </ul>
        </div>
        
    </div>

    <script>
        // 存储所有组员姓名（用于重置和验证）
        let allNames = [];
        // 存储已经被抽中的姓名，用于**内部排除**
        let drawnNamesHistory = new Set();
        // 存储本轮未被抽取的姓名，作为下一轮抽取的候选人
        let candidatesForNextRound = [];
        // 表格列数（必须定义，namesToTable 使用）
        const TABLE_COLS = 8;

        /**
         * 辅助函数：解析输入的姓名文本
         */
        function parseNames(text) {
            let names = text.split(/[\n,，\s]+/).map(name => name.trim()).filter(name => name.length > 0);
            return [...new Set(names)]; // 使用 Set 去重
        }

        /**
         * Fisher-Yates (Knuth) 洗牌算法
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * 抽取姓名函数（带老虎机滚动动画）
         */
        function drawNames() {
            tableToNames(); // 同步表格内容到隐藏 textarea（保证 parseNames 使用最新数据）
            const namesInput = document.getElementById('namesInput').value;
            const numToDraw = parseInt(document.getElementById('numToDraw').value);
            const errorMessage = document.getElementById('errorMessage');
            const currentDrawList = document.getElementById('currentDrawResult');
            const excludeInput = document.getElementById('excludeInput').value; // 虽然隐藏，但逻辑保留

            errorMessage.textContent = '';
            currentDrawList.innerHTML = '';

            allNames = parseNames(namesInput);

            if (candidatesForNextRound.length === 0) {
                if (drawnNamesHistory.size === allNames.length && allNames.length > 0) {
                    resetDrawingInternal();
                    errorMessage.textContent = '提示：所有组员都已被抽取至少一轮，已自动重置抽签历史。';
                }
                candidatesForNextRound = allNames.filter(name => !drawnNamesHistory.has(name));
            }

            if (isNaN(numToDraw) || numToDraw < 1 || numToDraw > 100) {
                errorMessage.textContent = '错误：抽取人数必须在 1 到 100 之间。';
                currentDrawList.innerHTML = '<li>（抽取失败）</li>';
                return;
            }
            if (candidatesForNextRound.length === 0) {
                errorMessage.textContent = '错误：当前候选人名单为空，请检查输入姓名。';
                currentDrawList.innerHTML = '<li>（抽取失败）</li>';
                return;
            }

            let excludeNames = new Set(parseNames(excludeInput));
            let workingCandidates = candidatesForNextRound.filter(name => !excludeNames.has(name));

            if (workingCandidates.length === 0) {
                errorMessage.textContent = '错误：排除名单把所有候选人都排除了。';
                currentDrawList.innerHTML = '<li>（抽取失败）</li>';
                return;
            }

            let drawn;
            if (numToDraw > workingCandidates.length) {
                errorMessage.textContent = `警告：要求抽取 ${numToDraw} 人，但当前候选仅剩 ${workingCandidates.length} 人。已抽取所有剩余候选人。`;
                drawn = workingCandidates.slice();
                candidatesForNextRound = [];
            } else {
                shuffleArray(workingCandidates);
                drawn = workingCandidates.splice(0, numToDraw);
                candidatesForNextRound = candidatesForNextRound.filter(n => !drawn.includes(n));
            }

            // 创建插槽（li.slot），并立即填入一个随机名字（避免首帧空白/停顿感）
            drawn.forEach((_, idx) => {
                const li = document.createElement('li');
                li.className = 'slot';
                const span = document.createElement('span');
                span.className = 'reel';
                span.textContent = allNames.length ? allNames[Math.floor(Math.random()*allNames.length)] : '—';
                li.appendChild(span);
                currentDrawList.appendChild(li);
            });

            function getRandomName() {
                return allNames.length ? allNames[Math.floor(Math.random() * allNames.length)] : '';
            }

            const reelEls = Array.from(document.querySelectorAll('#currentDrawResult .reel'));
            const baseDuration = 1200; // ms
            const tick = 60; // ms

            // 统一更新函数：在一次间隔内批量更新所有 reel 的文本（减少重排）
            function updateRandomBatch() {
                // 先生成所有随机文本，然后一次写回 DOM
                const texts = reelEls.map(() => getRandomName());
                reelEls.forEach((el, i) => {
                    // 仅在内容不同的情况下写入，减少不必要的 DOM 操作
                    if (el.textContent !== texts[i]) el.textContent = texts[i];
                });
            }

            // 立即做一次更新，避免等待第一个 setInterval 触发造成的“延后闪烁”
            updateRandomBatch();
            const intervalId = setInterval(updateRandomBatch, tick);

            // 到时停止滚动并一次性显示最终名单（同步出现）
            setTimeout(() => {
                clearInterval(intervalId);
                reelEls.forEach((el, i) => {
                    el.textContent = drawn[i] || '';
                    el.classList.add('selected-final');
                });
            }, baseDuration);

            // 更新历史记录
            drawn.forEach(name => drawnNamesHistory.add(name));

            if (candidatesForNextRound.length === 0 && drawnNamesHistory.size === allNames.length) {
                 errorMessage.textContent = '所有人都已被抽取至少一轮。请点击“重置抽签历史”开始新一轮循环！';
            }
        }

        /**
         * 内部重置逻辑（不更改界面显示，用于自动循环）
         */
        function resetDrawingInternal() {
            drawnNamesHistory.clear();
            allNames = parseNames(document.getElementById('namesInput').value);
            candidatesForNextRound = allNames.slice();
        }

        /**
         * 外部重置函数（更改界面显示，用户主动操作）
         */
        function resetDrawing() {
            resetDrawingInternal();
            document.getElementById('currentDrawResult').innerHTML = '<li>（抽签历史已重置）</li>';
            document.getElementById('errorMessage').textContent = ''; // 不显示“已成功重置所有抽签历史记录。”
        }

        // 自动根据内容调整 textarea 高度
        function autoResizeTextarea(el) {
            if (!el) return;
            el.style.height = 'auto';
            el.style.height = el.scrollHeight + 'px';
        }

        // 将隐藏 textarea 的内容加载到表格
        function namesToTable() {
            const txt = document.getElementById('namesInput').value || '';
            const names = parseNames(txt);
            const tbody = document.querySelector('#namesTable tbody');
            tbody.innerHTML = '';

            const rows = Math.max(1, Math.ceil(names.length / TABLE_COLS));
            for (let r = 0; r < rows; r++) {
                const tr = document.createElement('tr');
                let cellsHtml = '';
                for (let c = 0; c < TABLE_COLS; c++) {
                    const idx = r * TABLE_COLS + c;
                    const val = names[idx] || '';
                    cellsHtml += `<td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                    <input class="name-cell" value="${val.replace(/"/g,'&quot;')}" style="width:100%; border:none; outline:none; background:transparent;" />
                                  </td>`;
                }
                tr.innerHTML = cellsHtml;
                tbody.appendChild(tr);
            }

            attachTableListeners();
        }

        // 把表格内容写回隐藏 textarea（行优先，去除空值）
        function tableToNames() {
            const inputs = Array.from(document.querySelectorAll('#namesTable .name-cell'));
            const names = inputs.map(i => i.value.trim()).filter(s => s.length > 0);
            document.getElementById('namesInput').value = names.join('\n');
            return names;
        }

        function attachTableListeners() {
            const inputs = document.querySelectorAll('#namesTable .name-cell');
            inputs.forEach(inp => {
                inp.removeEventListener('input', onTableInput);
                inp.addEventListener('input', onTableInput);
            });
        }

        function onTableInput() {
            tableToNames();
        }

        // 添加一整行（8 个空单元格）
        function addEmptyRow() {
            const tbody = document.querySelector('#namesTable tbody');
            const tr = document.createElement('tr');
            let cellsHtml = '';
            for (let c = 0; c < TABLE_COLS; c++) {
                cellsHtml += `<td style="padding:6px; border-bottom:1px solid #f0f0f0; vertical-align:top;">
                                <input class="name-cell" value="" style="width:100%; border:none; outline:none; background:transparent;" />
                              </td>`;
            }
            tr.innerHTML = cellsHtml;
            tbody.appendChild(tr);
            attachTableListeners();
        }

        // 移除所有空行（行内所有单元均为空才移除）
        function removeEmptyRows() {
            const rows = Array.from(document.querySelectorAll('#namesTable tbody tr'));
            rows.forEach((tr) => {
                const inputs = Array.from(tr.querySelectorAll('.name-cell'));
                const allEmpty = inputs.every(i => !i.value.trim());
                if (allEmpty) tr.remove();
            });
            tableToNames();
        }

        document.addEventListener('DOMContentLoaded', () => {
            // 初始化：把隐藏 textarea 数据加载到表格并执行原有 init
            namesToTable();
            resetDrawing();

            // 如果需要仍保留自动调整隐藏 textarea 高度（对兼容无影响）
            const ta = document.getElementById('namesInput');
            if (ta) autoResizeTextarea(ta);
        });
    </script>
</body>
</html>

